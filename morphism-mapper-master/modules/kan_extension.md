---
module: kan_extension
version: 1
name: 坎扩展全息缩放器
description: 提供全息缩放能力——将局部验证的成功激进或保守地复制到全局市场
---

## Mathematical Foundation

**Kan 扩展 (Kan Extension)**：
给定函子 K: S → C 和 F: S → D，Kan 扩展是将 F "延拓" 到整个 C 上的通用构造。

**Left Kan Extension ($Lan_K F$)**：
自由延拓，追求最激进的结构保持。数学定义：
$$Lan_K F(C) = \text{colim}_{(S, K(S) \to C)} F(S)$$

**Right Kan Extension ($Ran_K F$)**：
保守延拓，追求最稳妥的约束满足。数学定义：
$$Ran_K F(C) = \text{lim}_{(C \to K(S))} F(S)$$

**商业映射**：
- **S (Source Category)** = 源范畴：局部已验证成功的市场/场景
  - 对象：已验证的用户群体、产品形态、商业模式
  - 态射：已被验证的因果链条、增长飞轮
  
- **C (Target Category)** = 目标范畴：待征服的全局市场
  - 对象：新地域、新客群、新渠道
  - 态射：待建立的本地化适配路径

- **K: S → C** = 嵌入函子：将局部成功映射到全局的"种子位置"

- **Left Kan (激进扩展)**：假设新市场与源市场结构相似，最大化复制成功要素
- **Right Kan (保守扩展)**：假设新市场存在未知约束，最小化假设、最大化本地适配

## Trigger

### 自动触发
当 **Adjoint Balancer** 检测到 "核心定理无法落地" 时自动调用：
- 理想方案在目标市场存在结构性障碍
- 约束条件过于复杂，伴随解难以生成
- 需要重新评估"复制什么"vs"适配什么"的边界

### 手动触发
命令：`/morphism-scale`

适用场景：
- "这个模式在一线城市跑通了，如何复制到下沉市场？"
- "我们在美国的策略很成功，怎么进入欧洲/东南亚？"
- "ToB业务验证成功，ToC市场怎么打？"
- "直营模式很成熟，加盟/代理如何设计？"

## Logic

### Step 1: 定义源范畴 S (Source)
**提取局部成功的核心结构**：

| 维度 | 分析项 | 关键问题 |
|------|--------|----------|
| **Context (上下文)** | 市场特征、用户画像、渠道结构、竞争格局 | 什么让成功成为可能？ |
| **Invariant (不变量)** | 核心假设、关键成功因素、不可妥协的要素 | 什么是必须复制的"神髓"？ |
| **Morphism (因果链)** | 增长飞轮、转化漏斗、运营SOP | 成功的机制是什么？ |
| **Object (对象)** | 产品形态、定价策略、服务交付方式 | 成功的载体是什么？ |

### Step 2: 定义目标范畴 C (Target)
**刻画新市场的结构差异**：

| 维度 | 分析项 | 关键问题 |
|------|--------|----------|
| **Context (上下文)** | 新市场的用户习惯、渠道特性、监管环境 | 新市场的"地形"如何？ |
| **Gap (差距)** | 与源市场的结构性差异 | 什么必须改变？ |
| **Constraint (约束)** | 资源限制、时间窗口、竞争压力 | 什么不能假设？ |
| **Opportunity (机会)** | 新市场特有的红利/空白 | 什么可以超越？ |

### Step 3: 计算 Left Kan Extension (激进扩展)
**策略逻辑**：最大化结构保持，假设"成功可以平移"

1. **识别 S 中的核心态射**（因果链条）
2. **假设 C 中存在对应的结构**（即使尚未验证）
3. **构造最自由的延拓**：将 F(S) 的结构尽可能完整地映射到 C
4. **生成激进方案**：
   - 复制率：80%+
   - 适配度：20%-
   - 风险：高（假设可能不成立）
   - 收益：高（如果假设成立，指数级增长）

### Step 4: 计算 Right Kan Extension (保守扩展)
**策略逻辑**：最大化约束满足，假设"本地适配优先"

1. **识别 C 中的所有约束条件**
2. **寻找满足约束的最小可行方案**
3. **构造最保守的延拓**：仅保留 F(S) 中不受约束影响的核心要素
4. **生成保守方案**：
   - 复制率：20%-
   - 适配度：80%+
   - 风险：低（基于已知约束）
   - 收益：中等（稳健但可能错失机会）

### Step 5: 失真度计算与策略选择 (Distortion Analysis)

在生成 Left Kan 和 Right Kan 方案后，必须计算**结构失真度 (Distortion Metric)**，作为策略选择的量化依据。

#### 失真度计算公式

**结构同构度 = Σ(维度权重 × 相似度评分)**

评估以下维度：

| 维度 | 权重 | 评估问题 | 评分标准 |
|------|------|----------|----------|
| **用户画像同构度** | 30% | 目标用户与源用户是否同类？ | 0-100% |
| **需求场景同构度** | 25% | 使用场景是否相似？ | 0-100% |
| **渠道结构同构度** | 20% | 获客/交付渠道是否相似？ | 0-100% |
| **竞争格局同构度** | 15% | 竞争态势是否相似？ | 0-100% |
| **监管环境同构度** | 10% | 法规约束是否相似？ | 0-100% |

**结构同构度 = 0.3×用户 + 0.25×需求 + 0.2×渠道 + 0.15×竞争 + 0.1×监管**

#### 失真度判定与策略推荐

| 同构度范围 | 失真等级 | 推荐策略 | 解释 |
|------------|----------|----------|------|
| **> 80%** | Low Distortion (低失真) | **Left Kan (激进扩展)** | 结构高度相似，直接复制成功率高 |
| **40% - 80%** | Medium Distortion (中失真) | **Right Kan (保守扩展)** 或 **Left Kan + 强力修正** | 结构有差异，需要本地化适配 |
| **< 40%** | High Distortion (高失真) | **⚠️ Kan Extension 失效** | 局部经验无法扩展，建议重新进行 Phase 1 提取 |

#### 失真度分析输出模板

```markdown
#### Step 5: 失真度分析与策略选择

**结构同构度计算**:
- 用户画像同构度: [0-100]% × 30% = [权重得分]
- 需求场景同构度: [0-100]% × 25% = [权重得分]
- 渠道结构同构度: [0-100]% × 20% = [权重得分]
- 竞争格局同构度: [0-100]% × 15% = [权重得分]
- 监管环境同构度: [0-100]% × 10% = [权重得分]

**综合同构度**: [XX]%

**失真等级**: [Low / Medium / High]

**策略推荐**: 
- 基于同构度分析，推荐采用 [Left Kan / Right Kan / 混合策略]
- 理由: [具体解释]

**⚠️ 警告 (如适用)**: 
若同构度 < 40%，当前问题可能不适合使用 Kan Extension，建议：
1. 重新进行 Phase 1 提取，识别更基础的结构性差异
2. 将问题视为全新的 Domain A，重新开始四阶段流程
3. 触发 Koan Break 进行问题重构
```

## Input/Output

### 输入
- 源市场 S 的成功案例/数据
- 目标市场 C 的市场研究报告
- 约束条件清单（资源、时间、法规等）
- 风险偏好（激进/平衡/保守）

### 输出格式

```markdown
### 【坎扩展分析】全息缩放策略

#### 源范畴 S (已验证成功)

**Context**: [源市场特征描述]
**核心不变量 (Invariant)**:
- 1. ...
- 2. ...
- 3. ...

**成功机制 (Morphism)**:
- 增长飞轮: ...
- 关键转化: ...
- 运营杠杆: ...

#### 目标范畴 C (待征服市场)

**Context**: [目标市场特征描述]
**结构性差异 (Gap)**:
- 用户行为: ...
- 渠道特性: ...
- 竞争格局: ...

**约束条件 (Constraint)**:
- 硬性约束: ...
- 软性约束: ...
- 时间窗口: ...

#### Left Kan Extension (激进扩展策略)

**核心假设**: [关于结构相似性的关键假设]

**方案概述**:
- 复制要素: [列出从 S 复制的核心要素]
- 复制率: ~80%
- 本地化程度: ~20%

**实施路径**:
1. [阶段1: 快速复制核心模式]
2. [阶段2: 验证假设成立]
3. [阶段3: 规模化扩张]

**风险识别**:
- 🔴 关键假设失效场景: ...
- 🔴 结构性差异被忽略: ...
- 🔴 本地化不足导致的排斥: ...

**成功指标**:
- 短期 (3个月): ...
- 中期 (6个月): ...
- 长期 (12个月): ...

#### Right Kan Extension (保守扩展策略)

**核心原则**: [最大化本地适配，最小化假设]

**方案概述**:
- 保留要素: [列出从 S 保留的最小核心]
- 复制率: ~20%
- 本地化程度: ~80%

**实施路径**:
1. [阶段1: 深度本地化调研]
2. [阶段2: MVP验证]
3. [阶段3: 渐进式复制]

**风险控制**:
- 🟢 每个假设都有验证机制
- 🟢 快速迭代，及时止损
- 🟢 保留源模式作为后备方案

**成功指标**:
- 短期 (3个月): ...
- 中期 (6个月): ...
- 长期 (12个月): ...

#### 策略对比与选择

| 维度 | Left Kan (激进) | Right Kan (保守) |
|------|-----------------|------------------|
| 资源需求 | 高 | 中 |
| 时间周期 | 短 (快攻) | 长 (渐进) |
| 风险等级 | 🔴 高 | 🟢 低 |
| 预期收益 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| 失败成本 | 极高 | 可控 |
| 适用场景 | 市场相似度高、窗口期短 | 市场差异大、资源有限 |

#### 【近似解】推荐方案

> **标注说明**: Kan Extension 模块的输出统一标记为【近似解】，以区别于 Adjoint Balancer 的【伴随解 η】。近似解强调在结构延拓过程中对源范畴成功要素的近似复制与适配，而非严格的伴随关系求解。

**选择**: [Left Kan / Right Kan / 混合策略]

**选择理由**:
1. ...
2. ...
3. ...

**关键决策点**:
- 如果 [条件A] 成立 → 转向激进策略
- 如果 [条件B] 出现 → 转向保守策略
- 不可逆点: [一旦执行就无法回头的节点]

**执行优先级**:
1. [第一优先级]
2. [第二优先级]
3. [第三优先级]

**退出条件**:
- ...
- ...
```

## Integration

**挂载点**：
- 被 **Adjoint Balancer** 调用：当理想方案因约束无法落地时，Kan Extension 提供"重新界定复制边界"的能力
- 可主动调用 **Natural Transformation**：根据策略类型触发不同模式

**作用**：
- 解决"成功复制"vs"本地适配"的根本张力
- 提供从局部到全局的结构化扩展路径
- 在激进与保守之间建立可量化的决策框架

**与其他模块的关系**：

| 调用关系 | 模块 | 触发条件 | 模式映射 |
|----------|------|----------|----------|
| **被调用** | Adjoint Balancer | 约束阻塞理想解时 | 自动触发 |
| **调用** | Natural Transformation | Left Kan 激进扩展时 | **Mode C** (策略演化) |
| **调用** | Natural Transformation | Right Kan 保守扩展时 | **Mode A/B** (视角对齐/颗粒度缩放) |

**深度限制**：2
- 防止在扩展分析中无限递归调用其他模块
- Kan Extension 调用 Natural Transformation 后不再继续链式调用

**关键词触发映射**：

| 用户话术关键词 | 策略倾向 | 推荐模式 |
|----------------|----------|----------|
| "快速复制"、"规模化"、"抢占市场" | Left Kan (激进) | Mode C (策略演化) |
| "稳扎稳打"、"本地化"、"适配调整" | Right Kan (保守) | Mode A/B (视角对齐/颗粒度缩放) |
| "既要...又要..."、"平衡" | 混合策略 | 先 Mode A 对齐，再评估 |
