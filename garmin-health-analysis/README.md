# Garmin Health Analysis (Garmin 健康数据分析)

> Talk to your Garmin data naturally. Access 20+ metrics, generate interactive dashboards, and perform advanced physiological analysis.

## 简介 (Introduction)

本技能允许你通过自然语言或命令行工具与 Garmin Connect 数据进行交互。它基于 **GEB-Flow** 架构，通过 `garminconnect` API 获取数据，并提供从基础数据导出到高阶生理指标分析（如流感风险预测、决策准备度）的全套解决方案。

主要功能包括：
- **数据获取**: 获取心率、睡眠、压力、Body Battery、HRV、SPO2 等 20+ 项指标。
- **智能分析**: 基于生理数据计算“患病风险”和“决策准备度”。
- **可视化**: 生成交互式 HTML 健康看板。
- **文件下载**: 下载 FIT/GPX 运动轨迹文件。
- **临床集成**: 支持导出 FHIR 格式数据。

## 目录结构 (Structure)

- `scripts/`: 核心 Python 脚本
  - `garmin_auth.py`: 认证与 Token 管理
  - `garmin_data.py`: 基础数据获取 (Summary, Sleep, etc.)
  - `garmin_chart.py`: 生成 HTML 可视化图表
  - `garmin_intelligence.py`: 高级生理分析 (Flu Risk, Readiness)
  - `garmin_activity_files.py`: 下载原始活动文件 (FIT/GPX) (新增)
  - `garmin_data_extended.py`: 扩展数据接口 (Detail, Stress, etc.) (新增)
  - `garmin_query.py`: 高级查询接口 (新增)
  - `garmin_fhir_adapter.py`: FHIR 格式适配器
- `output/`: 默认输出目录
- `install.sh`: 安装脚本

## 安装 (Installation)

1. **安装依赖**:
   ```bash
   ./install.sh
   # 或手动安装:
   pip install garminconnect fitparse gpxpy
   ```

2. **认证 (Authentication)**:
   首次使用需要登录 Garmin 账号：
   ```bash
   python scripts/garmin_auth.py login --email YOUR_EMAIL --password YOUR_PASSWORD
   ```
   检查登录状态：
   ```bash
   python scripts/garmin_auth.py status
   ```

## 使用指南 (Usage)

### 1. 基础数据查询 (Raw Data)
```bash
# 获取最近 7 天的综合数据
python scripts/garmin_data.py summary --days 7

# 获取睡眠数据
python scripts/garmin_data.py sleep --days 14
```

### 2. 可视化看板 (Dashboard)
生成包含心率、睡眠、压力和 Body Battery 的交互式 HTML 报告：
```bash
python scripts/garmin_chart.py dashboard --days 7
# 输出文件通常位于 output/garmin_dashboard_YYYYMMDD.html
```

### 3. 生理智能分析 (Intelligence)
```bash
# 监测“流感风险” (基于静息心率升高 + HRV 降低)
python scripts/garmin_intelligence.py flu_risk --days 7

# 计算“决策准备度” (基于睡眠、压力和 Body Battery)
python scripts/garmin_intelligence.py readiness
```

### 4. 扩展功能 (Advanced)
- **下载活动文件**:
  ```bash
  python scripts/garmin_activity_files.py download --count 5 --format fit
  ```
- **导出 FHIR 数据 (供医生查看)**:
  ```bash
  python scripts/garmin_fhir_adapter.py hrv --days 30
  ```

## 故障排除 (Troubleshooting)

- **401 Unauthorized**: Token 过期，请重新运行 `garmin_auth.py login`。
- **MFA (两步验证)**: 如果开启了 MFA，脚本会提示输入验证码。
- **Missing Data**: 请确保你的 Garmin 设备已同步到 Garmin Connect 云端。

---
*Generated by Gemini Agent based on SKILL.md analysis.*
